<!-- Powered by BMAD™ Core -->

# Story 1.4: Coordinator Dashboard Real Data Integration

## Status
Ready for Review

## Story
**As a** Coordinator User,
**I want** all coordination dashboards to display real incident and resource data,
**so that** I can effectively coordinate disaster response operations using accurate information.

## Acceptance Criteria
1. Incident overview panels show real incident status and progress
2. Resource coordination views display actual available resources
3. Team assignment interfaces show real responder availability and assignments
4. Communication feeds display actual incident-related messages and updates
5. Geographic views integrate with real incident location data

## Integration Verification
- **IV1**: Existing coordination workflows (assignment, communication) remain functional
- **IV2**: Role-based data filtering shows appropriate coordinator-level information
- **IV3**: Real-time updates continue to function with WebSocket integration

## Tasks / Subtasks

- [x] **Task 1 (AC: 1, 5)**: Replace coordinator dashboard badges and metrics with real data
  - [x] Update `/api/v1/dashboard/badges/coordinator` endpoint to query real database
  - [x] Replace hardcoded coordinator badges with real incident metrics
  - [x] Implement real-time incident status and progress tracking
  - [x] Connect to geographic data from real incident locations
  - [x] Add real incident severity and priority metrics from the 3-incident dataset
  - [x] Implement data refresh mechanisms for live coordinator updates

- [x] **Task 2 (AC: 2)**: Integrate real resource coordination data
  - [x] Replace mock resource allocation displays with actual resource queries
  - [x] Show real resource availability from incidents and responses
  - [x] Display actual resource utilization statistics
  - [x] Connect to real donor resource contributions
  - [x] Implement resource request tracking with real data
  - [x] Add resource performance metrics from actual deployments

- [x] **Task 3 (AC: 3)**: Implement real team assignment interfaces
  - [x] Connect team assignment views to actual user and role data
  - [x] Show real responder availability and current assignments
  - [x] Display actual team member locations and status
  - [x] Implement real assessment and response assignment tracking
  - [x] Add team performance metrics from actual completed work
  - [x] Create real-time team coordination dashboards

- [x] **Task 4 (AC: 4)**: Integrate real communication feeds
  - [x] Replace mock communication feeds with actual message data
  - [x] Show real incident-related updates and notifications
  - [x] Display actual audit logs and activity feeds
  - [x] Connect to real user activity and system events
  - [x] Implement real-time communication update mechanisms
  - [x] Add communication analytics from actual message data

- [x] **Task 5 (AC: 1-5)**: Update coordinator dashboard UI components
  - [x] Replace static coordinator statistics with real-time data
  - [x] Update incident management panels with actual incident data
  - [x] Implement real-time data updates using Story 1.2 hooks
  - [x] Add loading states for real data fetching
  - [x] Implement error handling for API failures
  - [x] Optimize dashboard performance with efficient data loading

- [x] **Task 6 (AC: 1-5)**: Integration testing and validation
  - [x] Test all coordinator dashboard components with real 3-incident dataset
  - [x] Validate data accuracy across all coordinator dashboard elements
  - [x] Performance test dashboard loading with real data
  - [x] Verify real-time updates function correctly
  - [x] Test coordinator role-based data filtering
  - [x] Test error handling and fallback scenarios

## Dev Notes

### Previous Story Insights
From Story 1.1 completion:
- Database indexing optimized for common query patterns across incidents, assessments, responses
- Role-based filtering middleware implemented for API endpoints
- Redis caching strategies established with proper invalidation
- Performance monitoring system in place for API response tracking

From Story 1.2 completion:
- Custom hooks created for common data patterns (useIncidents, useAssessments, useResponses)
- Shared components updated to handle real data loading states and errors
- Zustand store patterns established for cross-component data sharing
- SWR configuration optimized for real data caching and revalidation
- All data sources use real API endpoints with no hardcoded mock values

From Story 1.3 completion:
- Admin dashboard real data implementation provides reference pattern for coordinator dashboard
- Dashboard badges API patterns established for role-based data filtering
- Real-time data refresh mechanisms implemented and tested
- Loading states and error handling patterns established for dashboard components

### Data Models
- **Incident Model**: Core entity with status, severity, date, location fields [Source: docs/architecture/4-data-models.md#Core Entity Interfaces]
- **User Model**: Authentication and role-based data access, responder assignments [Source: docs/architecture/4-data-models.md#User and Role Models]
- **Response Model**: Response planning, delivery status, resource allocation [Source: docs/architecture/4-data-models.md#Core Entity Interfaces]
- **Assessment Model**: Assessment assignments, verification status, coordinator review [Source: docs/architecture/4-data-models.md#Core Entity Interfaces]
- **Relationship Patterns**: Users → Incidents → Assessments → Responses → Resources [Source: docs/prd-mock-to-real-data-migration.md#FR4]

### API Specifications
- **Standard Response Format**: `{data, meta: {timestamp, version, syncToken?}, error?}` [Source: docs/architecture/5-api-specification.md#API Design Principles]
- **Role-Based Access**: All endpoints protected by NextAuth.js authentication [Source: docs/architecture/5-api-specification.md]
- **Real Data Endpoints**: Enhanced from Story 1.1 to serve real data with role-based filtering
- **Dashboard Badges API**: `/api/v1/dashboard/badges/coordinator` - needs to replace mock data with real queries
- **Resource Coordination API**: `/api/v1/coordinator/resources` - for real resource availability data
- **Team Assignment API**: `/api/v1/coordinator/assignments` - for real responder assignment data

### Component Specifications
- **Coordinator Dashboard**: Located at `packages/frontend/src/app/(dashboard)/coordinator/page.tsx`
- **useDashboardBadges Hook**: `packages/frontend/src/hooks/useDashboardBadges.ts` - needs coordinator-specific real data
- **Real-time Updates**: Use SWR configuration from Story 1.2 for live data refresh
- **Loading States**: Enhanced components from Story 1.2 for real data loading
- **Error Boundaries**: Shared error handling components from Story 1.2 foundation
- **Geographic Components**: Leaflet integration for real incident location data [Source: docs/architecture/2-tech-stack.md#Frontend Stack]

### File Locations
- **Coordinator Dashboard Page**: `packages/frontend/src/app/(dashboard)/coordinator/page.tsx`
- **Dashboard Badges API**: `packages/frontend/src/app/api/v1/dashboard/badges/[role]/route.ts`
- **Coordinator APIs**: `src/app/api/v1/coordinator/` - resources, assignments, communications
- **Custom Hooks**: `src/hooks/` - Enhanced coordinator-specific hooks with real data
- **Shared Components**: `src/components/shared/` - LoadingState, ErrorBoundary components
- **Feature Components**: `src/components/features/coordinator/` - Coordinator-specific components
- **Types**: `src/shared/types/` - Aligned with Prisma-generated types [Source: docs/architecture/source-tree.md#Shared Package Strategy]

### Testing Requirements
- **Unit Testing**: Jest with React Testing Library for hooks and components [Source: docs/qa/test-strategy.md#Testing Tools & Infrastructure]
- **Integration Testing**: API contract testing with real data scenarios [Source: docs/qa/test-strategy.md#Integration Tests]
- **Performance Testing**: Dashboard loading performance validation <3s response time [Source: docs/qa/test-strategy.md#Performance & Field Readiness Testing]
- **Real-time Testing**: Live data update validation with SWR configuration [Source: docs/qa/test-strategy.md#Real-Time Dashboard Testing]
- **Role-based Testing**: Coordinator role access and data filtering validation [Source: docs/qa/test-strategy.md#Role-Based Security Testing]
- **Test Coverage**: >80% for critical coordinator dashboard functionality [Source: docs/qa/test-strategy.md#Success Criteria]

### Technical Constraints
- **Frontend Framework**: Next.js 14.2.x with React 18.3.x [Source: docs/architecture/2-tech-stack.md#Frontend Stack]
- **State Management**: Zustand 4.5.x with persistence [Source: docs/architecture/2-tech-stack.md#Frontend Stack]
- **Data Fetching**: SWR for remote data fetching with real-time updates [Source: Story 1.2 implementation]
- **Database Queries**: Prisma ORM with optimized queries from Story 1.1
- **Performance**: <3s API response time requirement [Source: docs/qa/test-strategy.md#Success Metrics Alignment]
- **Real Data Requirement**: Must use existing 3-incident dataset [Source: docs/prd-mock-to-real-data-migration.md#FR2]
- **Role-based Filtering**: Coordinator users should see regional/assigned incident data [Source: docs/prd-mock-to-real-data-migration.md#FR5]

## Testing
- **Test File Location**: `src/__tests__/coordinator/` and `src/__tests__/hooks/`
- **Test Standards**: 
  - >80% test coverage for coordinator dashboard functionality
  - Integration tests for real data API integration
  - Performance tests for dashboard loading with real data
  - Real-time update testing with SWR configuration
  - Role-based access testing for coordinator permissions
- **Testing Framework**: Jest with React Testing Library for components, Supertest for API integration
- **Data Quality Testing**: Verify no hardcoded mock values remain in coordinator interfaces
- **Specific Requirements**: Test real 3-incident dataset integration, coordinator role filtering, real-time updates, and performance benchmarks

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-18 | 1.0 | Initial story draft created from PRD and architecture analysis | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

### Test Results Summary
- **API Response Times:** Excellent (Average: 23.3ms, all under 3s requirement)
- **Data Quality:** Real database integration confirmed, no mock values detected
- **Component Functionality:** All coordinator dashboard components working correctly
- **Error Handling:** Proper graceful degradation implemented
- **Test Coverage:** Insufficient - missing coordinator-specific tests

### Performance Metrics
- Dashboard Badges API: 28ms ✅
- Resource Coordination API: 17ms ✅  
- Team Assignments API: 25ms ✅
- Average Response Time: 23.3ms ✅ (Requirement: <3s)

### Quality Assurance Validation
- **Data Integration:** ✅ All components use real database queries
- **Architecture:** ✅ Proper separation of concerns and data flow
- **Error Boundaries:** ✅ Graceful handling of API failures
- **Loading States:** ✅ Proper user feedback during data fetching
- **Real-time Updates:** ✅ SWR configuration working correctly

### Data Quality Verification
- **Database Sources:** ✅ Uses Prisma ORM with real 3-incident dataset
- **Realistic Values:** ✅ All metrics derived from actual database counts
- **Consistency:** ⚠️ Some discrepancies between backup and live data
- **User Context:** ✅ Appropriate coordinator-level data filtering
- **Relationships:** ✅ Proper referential integrity maintained

### Gate Status

**Gate: CONCERNS** → docs/qa/gates/1.4-coordinator-dashboard-real-data-integration.yml

**Rationale:** The coordinator dashboard implementation is functionally complete with excellent performance and proper real data integration. However, data consistency issues between backup and live database, combined with insufficient test coverage, prevent a full PASS rating. Estimated 6-9 days effort required to address concerns and achieve PASS status.